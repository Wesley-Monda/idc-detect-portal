{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-end mb-8">
        <div>
            <h1 class="text-3xl font-bold text-white">Patient Portal</h1>
            <p class="text-gray-400">Upload histopathology images for AI analysis</p>
        </div>
        <div class="text-right">
            <span
                class="inline-block px-3 py-1 rounded-full bg-blue-500/20 text-blue-300 text-xs font-semibold border border-blue-500/30">
                User: {{ user.username }}
            </span>
        </div>
    </div>

    <!-- Upload Section -->
    <div class="glass-card rounded-2xl p-8 mb-10">
        <form action="/patient/upload" method="post" enctype="multipart/form-data"
            class="flex flex-col items-center justify-center border-2 border-dashed border-gray-600 rounded-xl p-10 hover:border-blue-400 transition bg-white/5">
            <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
            </svg>
            <p class="text-gray-300 mb-2">Drag and drop your histopathology patch (PNG/JPG)</p>
            <p class="text-gray-500 text-sm mb-6">Recommended size: 50x50px</p>

            <input type="file" name="file" id="file" accept="image/png, image/jpeg" class="hidden"
                onchange="this.form.submit()">
            <label for="file"
                class="btn-primary text-white font-bold py-2 px-6 rounded-full cursor-pointer shadow-lg hover:shadow-blue-500/50">
                Select Image
            </label>
        </form>
    </div>

    <!-- History -->
    <h3 class="text-xl font-bold text-white mb-4">Analysis History</h3>
    <div class="space-y-4">
        {% for pred in predictions %}
        <div class="glass-card rounded-xl p-4 flex items-center space-x-4 transition hover:bg-white/10">
            <div class="relative w-16 h-16 rounded-lg overflow-hidden border border-white/10 shrink-0">
                <img src="/{{ pred.image_path }}" alt="Scan" class="object-cover w-full h-full">
            </div>

            <div class="flex-grow">
                <div class="flex items-center space-x-3 mb-1">
                    <span class="bg-gray-700 text-gray-300 text-xs px-2 py-0.5 rounded uppercase tracking-wide">{{
                        pred.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
                    {% if pred.status == 'Reviewed' %}
                    <span
                        class="bg-green-500/20 text-green-300 text-xs px-2 py-0.5 rounded border border-green-500/30">Verified
                        by Pathologist</span>
                    {% else %}
                    <span
                        class="bg-yellow-500/20 text-yellow-300 text-xs px-2 py-0.5 rounded border border-yellow-500/30">Pending
                        Review</span>
                    {% endif %}
                </div>

                <div class="flex items-baseline space-x-2">
                    <a href="/patient/result/{{ pred.id }}" class="hover:underline">
                        <span
                            class="text-lg font-bold {% if pred.result_class == 1 %}text-rose-400{% else %}text-emerald-400{% endif %}">
                            {% if pred.result_class == 1 %}Positive for IDC{% else %}Negative for IDC{% endif %}
                        </span>
                    </a>
                    <span class="text-sm text-gray-400">Confidence: {{ (pred.confidence * 100)|round(1) }}%</span>
                </div>
            </div>

            {% if pred.notes %}
            <div class="w-1/3 bg-black/30 p-3 rounded-lg text-sm text-gray-300 border-l-2 border-blue-500">
                <span class="block text-xs text-blue-400 font-bold mb-1">Pathologist Note:</span>
                {{ pred.notes }}
            </div>
            {% endif %}
        </div>
        {% endfor %}

        {% if not predictions %}
        <p class="text-gray-500 text-center py-8">No analysis history found.</p>
        {% endif %}
    </div>
</div>
{% endblock %}